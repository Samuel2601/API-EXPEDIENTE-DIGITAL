{
    "info": {
        "_postman_id": "f4e8b7d3-9a2c-4567-8901-234567890abc",
        "name": "GADMCE - Expediente Digital - Files API",
        "description": "Colecci√≥n de endpoints para la gesti√≥n de archivos del m√≥dulo de Expediente Digital\n\n**GADM Cant√≥n Esmeraldas - Sistema de Contrataci√≥n P√∫blica**\n\n## Funcionalidades incluidas:\n- ‚úÖ Upload de archivos\n- ‚úÖ CRUD de archivos\n- ‚úÖ Descarga y previsualizaci√≥n\n- ‚úÖ B√∫squeda avanzada\n- ‚úÖ Estad√≠sticas y reportes\n- ‚úÖ Validaci√≥n de archivos\n- ‚úÖ Limpieza de archivos hu√©rfanos\n\n## Variables necesarias:\n- `{{base_url}}`: URL base del API\n- `{{auth_token}}`: Token JWT de autenticaci√≥n\n- `{{file_id}}`: ID del archivo para operaciones espec√≠ficas",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [
        {
            "name": "üìÅ Gesti√≥n de Archivos",
            "item": [
                {
                    "name": "üì§ Subir archivos",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "body": {
                            "mode": "formdata",
                            "formdata": [
                                {
                                    "key": "files",
                                    "type": "file",
                                    "src": []
                                },
                                {
                                    "key": "contractId",
                                    "value": "{{contract_id}}",
                                    "type": "text"
                                },
                                {
                                    "key": "documentType",
                                    "value": "TDR",
                                    "type": "text",
                                    "description": "Tipo de documento seg√∫n fase contractual"
                                },
                                {
                                    "key": "phase",
                                    "value": "PREPARATORIA",
                                    "type": "text",
                                    "description": "Fase: PREPARATORIA, PRECONTRACTUAL, CONTRACTUAL, PAGO, RECEPCION"
                                },
                                {
                                    "key": "description",
                                    "value": "T√©rminos de referencia del proceso",
                                    "type": "text"
                                },
                                {
                                    "key": "isRequired",
                                    "value": "true",
                                    "type": "text"
                                },
                                {
                                    "key": "tags",
                                    "value": "terminos,referencia,preparatoria",
                                    "type": "text",
                                    "description": "Tags separados por coma"
                                }
                            ]
                        },
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/upload",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "upload"
                            ]
                        },
                        "description": "**Subir archivos al sistema**\n\n**Permisos requeridos:** `documents.canUpload`\n\n**Archivos soportados:**\n- PDF, DOC, DOCX, XLS, XLSX\n- JPG, PNG, GIF (im√°genes)\n- Tama√±o m√°ximo: 10MB por archivo\n\n**Validaciones:**\n- Tipos de archivo permitidos\n- Tama√±o m√°ximo\n- Virus scan (integraci√≥n con sistema antivirus)\n- Validaci√≥n de metadatos"
                    },
                    "response": [
                        {
                            "name": "‚úÖ Upload exitoso",
                            "originalRequest": {
                                "method": "POST",
                                "header": [
                                    {
                                        "key": "Authorization",
                                        "value": "Bearer {{auth_token}}"
                                    }
                                ],
                                "body": {
                                    "mode": "formdata",
                                    "formdata": [
                                        {
                                            "key": "files",
                                            "type": "file"
                                        }
                                    ]
                                },
                                "url": {
                                    "raw": "{{base_url}}/api/exp-digital/files/upload"
                                }
                            },
                            "status": "Created",
                            "code": 201,
                            "_postman_previewlanguage": "json",
                            "header": [],
                            "cookie": [],
                            "body": "{\n    \"success\": true,\n    \"message\": \"Archivos subidos correctamente\",\n    \"data\": {\n        \"uploadedFiles\": [\n            {\n                \"_id\": \"64f7e8b123456789abcdef01\",\n                \"originalName\": \"TDR-Proceso-001.pdf\",\n                \"fileName\": \"uploads/2025/01/64f7e8b123456789abcdef01.pdf\",\n                \"fileSize\": 2048576,\n                \"mimeType\": \"application/pdf\",\n                \"documentType\": \"TDR\",\n                \"phase\": \"PREPARATORIA\",\n                \"uploadedBy\": \"64f7e8b123456789abcdef02\",\n                \"uploadedAt\": \"2025-09-01T10:30:00.000Z\",\n                \"fileHash\": \"sha256:1234567890abcdef...\",\n                \"isProcessed\": true\n            }\n        ],\n        \"totalUploaded\": 1,\n        \"totalSize\": \"2.0 MB\"\n    }\n}"
                        }
                    ]
                },
                {
                    "name": "üìã Listar todos los archivos",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files?page=1&limit=20&documentType=TDR&phase=PREPARATORIA&sortBy=uploadedAt&sortOrder=desc",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files"
                            ],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "1",
                                    "description": "P√°gina actual"
                                },
                                {
                                    "key": "limit",
                                    "value": "20",
                                    "description": "Elementos por p√°gina"
                                },
                                {
                                    "key": "documentType",
                                    "value": "TDR",
                                    "description": "Filtro por tipo de documento"
                                },
                                {
                                    "key": "phase",
                                    "value": "PREPARATORIA",
                                    "description": "Filtro por fase"
                                },
                                {
                                    "key": "contractId",
                                    "value": "{{contract_id}}",
                                    "description": "Filtro por contrato",
                                    "disabled": true
                                },
                                {
                                    "key": "uploadedBy",
                                    "value": "{{user_id}}",
                                    "description": "Filtro por usuario que subi√≥",
                                    "disabled": true
                                },
                                {
                                    "key": "dateFrom",
                                    "value": "2025-01-01",
                                    "description": "Fecha desde (YYYY-MM-DD)",
                                    "disabled": true
                                },
                                {
                                    "key": "dateTo",
                                    "value": "2025-12-31",
                                    "description": "Fecha hasta (YYYY-MM-DD)",
                                    "disabled": true
                                },
                                {
                                    "key": "tags",
                                    "value": "terminos,referencia",
                                    "description": "Filtro por tags",
                                    "disabled": true
                                },
                                {
                                    "key": "sortBy",
                                    "value": "uploadedAt",
                                    "description": "Campo de ordenamiento"
                                },
                                {
                                    "key": "sortOrder",
                                    "value": "desc",
                                    "description": "Orden: asc, desc"
                                }
                            ]
                        },
                        "description": "**Obtener todos los archivos con filtros**\n\n**Permisos requeridos:** `documents.canView`\n\n**Filtros disponibles:**\n- `documentType`: Tipo de documento\n- `phase`: Fase contractual\n- `contractId`: ID del contrato\n- `uploadedBy`: Usuario que subi√≥\n- `dateFrom/dateTo`: Rango de fechas\n- `tags`: Tags del documento\n- `isProcessed`: Si fue procesado\n- `fileSize`: Tama√±o del archivo\n\n**Ordenamiento:**\n- `sortBy`: uploadedAt, fileName, fileSize, documentType\n- `sortOrder`: asc, desc"
                    },
                    "response": []
                },
                {
                    "name": "üîç Obtener archivo por ID",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/{{file_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "{{file_id}}"
                            ]
                        },
                        "description": "**Obtener informaci√≥n detallada de un archivo**\n\n**Permisos requeridos:** `documents.canView` + acceso al archivo\n\n**Incluye:**\n- Metadatos completos\n- Historial de modificaciones\n- Informaci√≥n de seguridad\n- Enlaces de descarga temporal\n- Versiones del archivo"
                    },
                    "response": []
                },
                {
                    "name": "‚úèÔ∏è Actualizar metadatos",
                    "request": {
                        "method": "PUT",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"description\": \"T√©rminos de referencia actualizados - Proceso 001\",\n    \"documentType\": \"TDR_ACTUALIZADO\",\n    \"tags\": [\"terminos\", \"referencia\", \"actualizado\", \"proceso-001\"],\n    \"isRequired\": true,\n    \"metadata\": {\n        \"version\": \"1.1\",\n        \"author\": \"Departamento de Compras\",\n        \"reviewedBy\": \"Jefe de Adquisiciones\",\n        \"approvalDate\": \"2025-09-01\"\n    },\n    \"customFields\": {\n        \"processNumber\": \"GADMCE-001-2025\",\n        \"budgetCode\": \"530101\",\n        \"priority\": \"HIGH\"\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/{{file_id}}",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "{{file_id}}"
                            ]
                        },
                        "description": "**Actualizar metadatos del archivo**\n\n**Permisos requeridos:** `documents.canEdit` + propiedad del archivo\n\n**Campos actualizables:**\n- `description`: Descripci√≥n del archivo\n- `documentType`: Tipo de documento\n- `tags`: Array de etiquetas\n- `isRequired`: Si es requerido\n- `metadata`: Metadatos personalizados\n- `customFields`: Campos adicionales\n\n**Nota:** No se puede cambiar el archivo f√≠sico, solo sus metadatos"
                    },
                    "response": []
                },
                {
                    "name": "üóëÔ∏è Eliminar archivo",
                    "request": {
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/{{file_id}}?reason=Archivo obsoleto&forceDelete=false",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "{{file_id}}"
                            ],
                            "query": [
                                {
                                    "key": "reason",
                                    "value": "Archivo obsoleto",
                                    "description": "Raz√≥n de eliminaci√≥n"
                                },
                                {
                                    "key": "forceDelete",
                                    "value": "false",
                                    "description": "Eliminaci√≥n f√≠sica (solo admin)"
                                }
                            ]
                        },
                        "description": "**Eliminar archivo (soft delete)**\n\n**Permisos requeridos:** `documents.canDelete` + propiedad del archivo\n\n**Tipos de eliminaci√≥n:**\n- **Soft Delete (default)**: Marca como eliminado, preserva archivo\n- **Force Delete**: Eliminaci√≥n f√≠sica (solo administradores)\n\n**Validaciones:**\n- El archivo no debe estar siendo usado en procesos activos\n- Debe especificar raz√≥n de eliminaci√≥n\n- Backup autom√°tico antes de eliminaci√≥n f√≠sica"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "‚¨áÔ∏è Descarga y Previsualizaci√≥n",
            "item": [
                {
                    "name": "üì• Descargar archivo",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/{{file_id}}/download?inline=false&watermark=true",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "{{file_id}}",
                                "download"
                            ],
                            "query": [
                                {
                                    "key": "inline",
                                    "value": "false",
                                    "description": "Ver en navegador vs descargar"
                                },
                                {
                                    "key": "watermark",
                                    "value": "true",
                                    "description": "Agregar marca de agua"
                                },
                                {
                                    "key": "version",
                                    "value": "latest",
                                    "description": "Versi√≥n espec√≠fica",
                                    "disabled": true
                                }
                            ]
                        },
                        "description": "**Descargar archivo**\n\n**Permisos requeridos:** `documents.canDownload` + acceso al archivo\n\n**Opciones:**\n- `inline`: true = ver en navegador, false = descarga\n- `watermark`: Agregar marca de agua con info del usuario\n- `version`: Descargar versi√≥n espec√≠fica\n\n**Seguridad:**\n- URL de descarga temporal (expires en 1 hora)\n- Registro de auditor√≠a de descargas\n- Control de acceso por departamento/rol"
                    },
                    "response": []
                },
                {
                    "name": "üëÅÔ∏è Previsualizar archivo",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/{{file_id}}/preview?page=1&quality=medium&size=800x600",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "{{file_id}}",
                                "preview"
                            ],
                            "query": [
                                {
                                    "key": "page",
                                    "value": "1",
                                    "description": "P√°gina del PDF (si aplica)"
                                },
                                {
                                    "key": "quality",
                                    "value": "medium",
                                    "description": "Calidad: low, medium, high"
                                },
                                {
                                    "key": "size",
                                    "value": "800x600",
                                    "description": "Tama√±o de preview"
                                }
                            ]
                        },
                        "description": "**Previsualizar archivo (im√°genes y PDFs)**\n\n**Permisos requeridos:** `documents.canView` + acceso al archivo\n\n**Soportado para:**\n- PDFs (primera p√°gina o p√°gina espec√≠fica)\n- Im√°genes (JPG, PNG, GIF)\n- Documentos de Office (convertidos a imagen)\n\n**Par√°metros:**\n- `page`: P√°gina espec√≠fica para PDFs\n- `quality`: Calidad de la imagen generada\n- `size`: Dimensiones del preview"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "üîç B√∫squeda y Filtros",
            "item": [
                {
                    "name": "üîç B√∫squeda avanzada",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"searchTerm\": \"t√©rminos referencia\",\n    \"filters\": {\n        \"documentTypes\": [\"TDR\", \"PLIEGOS\", \"CONTRATO\"],\n        \"phases\": [\"PREPARATORIA\", \"PRECONTRACTUAL\"],\n        \"dateRange\": {\n            \"from\": \"2025-01-01\",\n            \"to\": \"2025-12-31\"\n        },\n        \"fileSizeRange\": {\n            \"min\": 1048576,\n            \"max\": 10485760\n        },\n        \"tags\": [\"proceso\", \"adquisiciones\"],\n        \"uploadedBy\": [\"64f7e8b123456789abcdef02\"],\n        \"departments\": [\"{{department_id}}\"],\n        \"isRequired\": true,\n        \"hasContract\": true\n    },\n    \"searchOptions\": {\n        \"includeContent\": true,\n        \"fuzzyMatch\": true,\n        \"highlightResults\": true,\n        \"includeDeleted\": false\n    },\n    \"sortBy\": \"relevance\",\n    \"sortOrder\": \"desc\",\n    \"page\": 1,\n    \"limit\": 20\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/search",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "search"
                            ]
                        },
                        "description": "**B√∫squeda avanzada de archivos**\n\n**Permisos requeridos:** `documents.canView`\n\n**Capacidades de b√∫squeda:**\n- Texto completo en metadatos y contenido\n- B√∫squeda fuzzy (tolerante a errores)\n- Filtros m√∫ltiples combinados\n- Destacado de resultados\n- B√∫squeda en contenido de PDFs (OCR)\n\n**Filtros avanzados:**\n- Rangos de fechas y tama√±os\n- M√∫ltiples tipos de documento\n- Tags y metadatos personalizados\n- Estado y departamento\n- Usuario que subi√≥"
                    },
                    "response": []
                },
                {
                    "name": "üìä Estad√≠sticas de archivos",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/statistics?period=last30days&groupBy=documentType&includeDepartments=true",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "statistics"
                            ],
                            "query": [
                                {
                                    "key": "period",
                                    "value": "last30days",
                                    "description": "Per√≠odo: today, last7days, last30days, lastYear, custom"
                                },
                                {
                                    "key": "groupBy",
                                    "value": "documentType",
                                    "description": "Agrupar por: documentType, phase, department, user, date"
                                },
                                {
                                    "key": "includeDepartments",
                                    "value": "true",
                                    "description": "Incluir estad√≠sticas por departamento"
                                },
                                {
                                    "key": "dateFrom",
                                    "value": "2025-08-01",
                                    "description": "Para per√≠odo custom",
                                    "disabled": true
                                },
                                {
                                    "key": "dateTo",
                                    "value": "2025-09-01",
                                    "description": "Para per√≠odo custom",
                                    "disabled": true
                                }
                            ]
                        },
                        "description": "**Obtener estad√≠sticas de archivos**\n\n**Permisos requeridos:** `documents.canView`\n\n**Estad√≠sticas incluidas:**\n- Total de archivos por tipo\n- Distribuci√≥n por fases\n- Archivos por departamento\n- Tendencias temporales\n- Tama√±o total usado\n- Archivos m√°s descargados\n- Usuarios m√°s activos\n\n**Agrupaciones:**\n- Por tipo de documento\n- Por fase contractual\n- Por departamento\n- Por usuario\n- Por fecha"
                    },
                    "response": []
                }
            ]
        },
        {
            "name": "üõ†Ô∏è Utilidades y Configuraci√≥n",
            "item": [
                {
                    "name": "üìù Tipos de documentos",
                    "request": {
                        "method": "GET",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            }
                        ],
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/document-types?phase=PREPARATORIA&includeDescriptions=true",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "document-types"
                            ],
                            "query": [
                                {
                                    "key": "phase",
                                    "value": "PREPARATORIA",
                                    "description": "Filtrar por fase espec√≠fica"
                                },
                                {
                                    "key": "includeDescriptions",
                                    "value": "true",
                                    "description": "Incluir descripciones detalladas"
                                }
                            ]
                        },
                        "description": "**Obtener tipos de documentos disponibles**\n\n**Permisos requeridos:** Acceso b√°sico al m√≥dulo\n\n**Por fase:**\n- **PREPARATORIA**: PAC, TDR, Estudios de mercado, Resoluciones\n- **PRECONTRACTUAL**: Pliegos, Ofertas, Informes de evaluaci√≥n\n- **CONTRACTUAL**: Contrato, Garant√≠as, Cronogramas, Actas\n- **PAGO**: Facturas, Planillas, Comprobantes\n- **RECEPCION**: Acta definitiva, Informes finales\n\n**Incluye:**\n- C√≥digo del tipo\n- Nombre descriptivo\n- Fase asociada\n- Si es requerido\n- Formatos aceptados"
                    },
                    "response": []
                },
                {
                    "name": "‚úÖ Validar archivos",
                    "request": {
                        "method": "POST",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"files\": [\n        {\n            \"fileName\": \"TDR-Proceso-001.pdf\",\n            \"fileSize\": 2048576,\n            \"mimeType\": \"application/pdf\",\n            \"documentType\": \"TDR\",\n            \"phase\": \"PREPARATORIA\",\n            \"checksum\": \"sha256:1234567890abcdef...\"\n        },\n        {\n            \"fileName\": \"Pliego-Condiciones.docx\",\n            \"fileSize\": 1536000,\n            \"mimeType\": \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n            \"documentType\": \"PLIEGOS\",\n            \"phase\": \"PRECONTRACTUAL\",\n            \"checksum\": \"sha256:abcdef1234567890...\"\n        }\n    ],\n    \"contractId\": \"{{contract_id}}\",\n    \"validationLevel\": \"strict\",\n    \"options\": {\n        \"checkDuplicates\": true,\n        \"validateContent\": true,\n        \"scanVirus\": true,\n        \"checkMetadata\": true\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/validate",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "validate"
                            ]
                        },
                        "description": "**Validar archivos antes de subir**\n\n**Permisos requeridos:** `documents.canUpload`\n\n**Validaciones realizadas:**\n- Tipo de archivo permitido\n- Tama√±o m√°ximo\n- Estructura del documento\n- Duplicados por checksum\n- Escaneo de virus\n- Metadatos requeridos\n- Compatibilidad con fase\n\n**Niveles de validaci√≥n:**\n- `basic`: Validaciones m√≠nimas\n- `standard`: Validaciones est√°ndar\n- `strict`: Todas las validaciones\n\n**Respuesta incluye:**\n- Estado de cada validaci√≥n\n- Errores y advertencias\n- Sugerencias de correcci√≥n"
                    },
                    "response": []
                },
                {
                    "name": "üßπ Limpiar archivos hu√©rfanos",
                    "request": {
                        "method": "DELETE",
                        "header": [
                            {
                                "key": "Authorization",
                                "value": "Bearer {{auth_token}}",
                                "type": "text"
                            },
                            {
                                "key": "Content-Type",
                                "value": "application/json"
                            }
                        ],
                        "body": {
                            "mode": "raw",
                            "raw": "{\n    \"dryRun\": true,\n    \"olderThanDays\": 30,\n    \"filters\": {\n        \"excludeRecentlyAccessed\": true,\n        \"excludeSystemFiles\": true,\n        \"minFileSize\": 1048576,\n        \"documentTypes\": [\"TEMP\", \"DRAFT\"]\n    },\n    \"options\": {\n        \"createBackup\": true,\n        \"sendNotification\": true,\n        \"generateReport\": true\n    }\n}"
                        },
                        "url": {
                            "raw": "{{base_url}}/api/exp-digital/files/cleanup",
                            "host": [
                                "{{base_url}}"
                            ],
                            "path": [
                                "api",
                                "exp-digital",
                                "files",
                                "cleanup"
                            ]
                        },
                        "description": "**Limpiar archivos hu√©rfanos (sin referencias)**\n\n**Permisos requeridos:** `special.canManageFiles` (solo administradores)\n\n**Tipos de limpieza:**\n- Archivos sin referencias en contratos\n- Archivos temporales antiguos\n- Duplicados exactos\n- Archivos de prueba\n\n**Opciones de seguridad:**\n- `dryRun`: Solo mostrar qu√© se eliminar√≠a\n- `createBackup`: Crear respaldo antes de eliminar\n- `olderThanDays`: Solo archivos m√°s antiguos\n\n**Filtros:**\n- Excluir archivos accedidos recientemente\n- Excluir archivos del sistema\n- Tama√±o m√≠nimo de archivo\n- Tipos espec√≠ficos de documento\n\n**‚ö†Ô∏è PRECAUCI√ìN:** Esta operaci√≥n es irreversible si no se usa dryRun"
                    },
                    "response": []
                }
            ]
        }
    ],
    "event": [
        {
            "listen": "prerequest",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Auto-generar IDs si no existen",
                    "if (!pm.collectionVariables.get('file_id')) {",
                    "    pm.collectionVariables.set('file_id', '64f7e8b123456789abcdef01');",
                    "}",
                    "",
                    "if (!pm.collectionVariables.get('contract_id')) {",
                    "    pm.collectionVariables.set('contract_id', '64f7e8b123456789abcdef99');",
                    "}",
                    "",
                    "// Validar token de autorizaci√≥n",
                    "const authToken = pm.collectionVariables.get('auth_token') || pm.globals.get('auth_token');",
                    "if (!authToken) {",
                    "    console.log('‚ö†Ô∏è WARNING: No se encontr√≥ token de autorizaci√≥n');",
                    "    console.log('Configura la variable auth_token en Collection o Global variables');",
                    "}"
                ]
            }
        },
        {
            "listen": "test",
            "script": {
                "type": "text/javascript",
                "exec": [
                    "// Tests globales para todas las respuestas",
                    "pm.test('Response time is reasonable', function () {",
                    "    pm.expect(pm.response.responseTime).to.be.below(5000);",
                    "});",
                    "",
                    "pm.test('Response has correct headers', function () {",
                    "    pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
                    "});",
                    "",
                    "// Guardar datos √∫tiles para siguientes requests",
                    "if (pm.response.code === 200 || pm.response.code === 201) {",
                    "    const responseJson = pm.response.json();",
                    "    ",
                    "    // Guardar file_id si se crea un archivo",
                    "    if (responseJson.data && responseJson.data.uploadedFiles) {",
                    "        const firstFile = responseJson.data.uploadedFiles[0];",
                    "        if (firstFile && firstFile._id) {",
                    "            pm.collectionVariables.set('file_id', firstFile._id);",
                    "            console.log('‚úÖ Guardado file_id:', firstFile._id);",
                    "        }",
                    "    }",
                    "    ",
                    "    // Guardar file_id si se obtiene un archivo individual",
                    "    if (responseJson.data && responseJson.data._id) {",
                    "        pm.collectionVariables.set('file_id', responseJson.data._id);",
                    "    }",
                    "}"
                ]
            }
        }
    ],
    "variable": [
        {
            "key": "base_url",
            "value": "http://localhost:3000",
            "type": "string",
            "description": "URL base del API - Cambiar seg√∫n entorno"
        },
        {
            "key": "auth_token",
            "value": "",
            "type": "string",
            "description": "Token JWT de autenticaci√≥n - Obtener de /auth/login"
        },
        {
            "key": "file_id",
            "value": "64f7e8b123456789abcdef01",
            "type": "string",
            "description": "ID del archivo para pruebas - Se actualiza autom√°ticamente"
        },
        {
            "key": "contract_id",
            "value": "64f7e8b123456789abcdef99",
            "type": "string",
            "description": "ID del contrato asociado - Configurar seg√∫n necesidad"
        },
        {
            "key": "user_id",
            "value": "64f7e8b123456789abcdef02",
            "type": "string",
            "description": "ID del usuario para filtros - Opcional"
        },
        {
            "key": "department_id",
            "value": "64f7e8b123456789abcdef03",
            "type": "string",
            "description": "ID del departamento para filtros - Opcional"
        }
    ]
}